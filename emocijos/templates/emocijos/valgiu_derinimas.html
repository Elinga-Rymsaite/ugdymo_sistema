{% load static %}
<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8" />
  <title>Maisto rÅ«Å¡iavimas</title>
 <link rel="stylesheet" href="{% static 'css/valgiu_derinimas.css' %}">
</head>
<body>
  <a href="/" class="atgal"></a>
  <button id="mute-button" onclick="toggleMute()"></button>
  <button id="reset-button" onclick="resetuotiZaidima()" title="Atstatyti Å¾aidimÄ…"></button>
  <audio id="background-music" autoplay loop>
    <source src="{% static 'audio/emoji.mp3' %}" type="audio/mpeg" />
    JÅ«sÅ³ narÅ¡yklÄ— nepalaiko audio formato.
  </audio>
  <audio id="incorrect-sound">
    <source src="{% static 'audio/neteisingai.mp3' %}" type="audio/mpeg" />
    JÅ«sÅ³ narÅ¡yklÄ— nepalaiko audio formato.
  </audio>

  <h1>RÅ«Å¡iuok maistÄ… Ä¯ tinkamas kategorijas</h1>

  <div class="kategorijos">
    <div class="kategorija" data-category="PusryÄiai" ondragover="allowDrop(event)">
      <h3>ğŸ¥£ PusryÄiai</h3>
    </div>
    <div class="kategorija" data-category="PietÅ«s" ondragover="allowDrop(event)">
      <h3>ğŸ½ï¸ PietÅ«s</h3>
    </div>
    <div class="kategorija" data-category="VakarienÄ—" ondragover="allowDrop(event)">
      <h3>ğŸŒ™ VakarienÄ—</h3>
    </div>
    <div class="kategorija" data-category="UÅ¾kandÅ¾iai" ondragover="allowDrop(event)">
      <h3>ğŸ¬ UÅ¾kandÅ¾iai</h3>
    </div>
  </div>

  <div class="produktai" id="produktai"></div>

  <!-- END SCREEN -->
  <div id="end-screen" class="modal">
    <div class="overlay">
      <button id="closeModalButton" onclick="uzdarytiPabaigosLangÄ…()">âœ–</button>
      <img src="{% static 'image/pabaigosmais.png' %}" alt="Puikiai atlikai!" class="end-image" />
      <h2>ğŸ‰ Puikiai padirbÄ—ta! ğŸ‰<br />Tu jau beveik tikras mitybos ekspertas!</h2>
      <button onclick="location.reload()">ğŸ” Å½aisti dar kartÄ…</button>
    </div>
  </div>

  <script>
    const produktuDuomenys = [
      ['ğŸ', 'Obuolys', 'UÅ¾kandÅ¾iai'],
      ['ğŸŒ', 'Bananas', 'UÅ¾kandÅ¾iai'],
      ['ğŸ²', 'Sriuba', 'PietÅ«s'],
      ['ğŸŠ', 'Apelsinai', 'UÅ¾kandÅ¾iai'],
      ['ğŸ¥£', 'Jogurtas', 'PusryÄiai'],
      ['ğŸª', 'Sausainis', 'UÅ¾kandÅ¾iai'],
      ['ğŸ', 'Duona', 'PusryÄiai'],
      ['ğŸ¥—', 'Salotos', 'PietÅ«s'],
      ['ğŸ“', 'BraÅ¡kÄ—s', 'UÅ¾kandÅ¾iai'],
      ['ğŸ¥•', 'Morka', 'PietÅ«s'],
      ['ğŸ¥ª', 'SumuÅ¡tinis', 'PusryÄiai'],
      ['ğŸ‰', 'ArbÅ«zas', 'UÅ¾kandÅ¾iai'],
      ['ğŸ¥’', 'Agurkas', 'PietÅ«s'],
      ['ğŸ', 'Ananasas', 'UÅ¾kandÅ¾iai'],
      ['ğŸ¥¬', 'Å pinatai', 'PietÅ«s'],
      ['ğŸ¥©', 'Kepsnys', 'VakarienÄ—'],
      ['ğŸ—', 'ViÅ¡tiena', 'PietÅ«s'],
      ['ğŸ§€', 'SÅ«ris', 'PusryÄiai'],
      ['ğŸ°', 'Pyragas', 'UÅ¾kandÅ¾iai'],
      ['ğŸ¦', 'Ledai', 'UÅ¾kandÅ¾iai'],
      ['ğŸ¥”', 'BulvÄ—s', 'PietÅ«s'],
      ['ğŸ‡', 'VynuogÄ—s', 'UÅ¾kandÅ¾iai'],
      ['ğŸ¥¯', 'BandelÄ—', 'PusryÄiai']
    ];

    const produktaiBox = document.getElementById('produktai');

    function renderProduktai() {
      produktaiBox.innerHTML = '';
      produktuDuomenys.forEach(([emoji, pavadinimas, kategorija]) => {
        const div = document.createElement('div');
        div.className = 'produktas';
        div.draggable = true;
        div.innerHTML = `<div class="emoji">${emoji}</div>${pavadinimas}`;
        div.dataset.name = pavadinimas;
        div.dataset.category = kategorija;
        div.id = 'prod-' + pavadinimas;
        produktaiBox.appendChild(div);
      });
    }

    function allowDrop(e) {
      e.preventDefault();
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderProduktai();

      const music = document.getElementById('background-music');
      music.volume = 0.10;

      const incorrectSound = document.getElementById('incorrect-sound');
      incorrectSound.volume = 0.5;

      document.addEventListener('dragstart', e => {
        if (e.target && e.target.classList && e.target.classList.contains('produktas')) {
          e.dataTransfer.setData('text/plain', e.target.dataset.name);
        }
      });

      document.addEventListener('drop', e => {
        e.preventDefault();
        const name = e.dataTransfer.getData('text/plain');
        const produktas = document.getElementById('prod-' + name);
        const targetKategorija = e.target.closest('.kategorija');

        if (targetKategorija && produktas) {
          const correctCategory = produktas.dataset.category;
          const targetCategory = targetKategorija.dataset.category;

          if (correctCategory === targetCategory) {
            const clone = produktas.cloneNode(true);
            clone.id = '';
            clone.draggable = false;
            clone.addEventListener('click', () => {
              produktaiBox.appendChild(produktas);
              clone.remove();
              tikrintiArUÅ¾duotisBaigta();
            });
            produktas.remove();
            targetKategorija.appendChild(clone);
            tikrintiArUÅ¾duotisBaigta();
          } else {
            incorrectSound.play();
          }
        }
      });

      const muteButton = document.getElementById('mute-button');
      const savedMuteState = localStorage.getItem('muteState');
      if (savedMuteState === 'muted') {
        music.muted = true;
        incorrectSound.muted = true;
        muteButton.classList.add('muted');
      } else {
        music.muted = false;
        incorrectSound.muted = false;
        muteButton.classList.remove('muted');
      }

      document.getElementById('end-screen').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) {
          uzdarytiPabaigosLangÄ…();
        }
      });
    });

    function parodytiPabaigosLangÄ…() {
      document.getElementById('end-screen').style.display = 'flex';
    }

    function uzdarytiPabaigosLangÄ…() {
      document.getElementById('end-screen').style.display = 'none';
    }

    function tikrintiArUÅ¾duotisBaigta() {
      const likÄ™Produktai = document.querySelectorAll('#produktai .produktas');
      if (likÄ™Produktai.length === 0) {
        setTimeout(parodytiPabaigosLangÄ…, 500);
      }
    }

    function toggleMute() {
      const music = document.getElementById('background-music');
      const incorrectSound = document.getElementById('incorrect-sound');
      const muteButton = document.getElementById('mute-button');
      music.muted = !music.muted;
      incorrectSound.muted = music.muted;
      muteButton.classList.toggle('muted', music.muted);
      localStorage.setItem('muteState', music.muted ? 'muted' : 'unmuted');
    }

    function resetuotiZaidima() {
      location.reload();
    }
  </script>
</body>
</html>